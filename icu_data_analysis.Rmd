---
title: 'ICU Data Analysis'
output:
  html_document:
    df_print: paged
  html_notebook: default
  pdf_document: default
---
```{r}
#load data 
load("icu.Rdata")

#load libraries
library(tidyverse)
```
```{r}
#view the data
glimpse(icu)
```

Preliminary Visualizations of Variables  
```{r}
#Independent Variable
table(icu$vital.status)

#Demographics 
table(icu$age)
table(icu$race)
table(icu$gender)

#Plots of demographics and y-variable
barplot(table(icu$vital.status))
barplot(table(icu$age))
barplot(table(icu$race))
barplot(table(icu$gender))
```
The study population is primarily white males between the ages of 55 and 75. The majority of patients also survived after their visit to the ICU. 

The percentages of patients in each demographic category have been calculated below:
```{r}
#Race : White, Black, or other
race_stats <- c(175/200, 15/200, 10/200)
race_stats

#Gender : Male or Female
gender_stats <- c(124/200, 76/200)
gender_stats

#Vital Status : Lived or Died
vital_stats <- c(160/200, 40/200)
vital_stats
```
It can be concluded that 87.5% of the patients are white whereas only 7.5% are black. The calculations additionally show us that 62% are male and 38% of the patients are female. Lastly, 80% of the ICU patients survived following their hospital discharge and 20% died. 


```{r}
#General factors
table(icu$conscious)
table(icu$previous)
table(icu$service)
table(icu$type)

#Barplots of general factors
barplot(table(icu$conscious))
barplot(table(icu$previous))
barplot(table(icu$service))
barplot(table(icu$type))
```
The percentages of patients in each general category have been calculated below:

```{r}
#Conscious : No coma/stupor, deep stupor, or coma
cons_stats <- c(185/200, 5/200, 10/200)
cons_stats

#Previous : No or yes
prev_stats <- c(170/200, 30/200)
prev_stats

#Service : Medical or Surgical
serv_stats <- c(93/200, 107/200)
serv_stats

#Type : Elective or Emergency
type_stats <- c(53/200, 147/200)
type_stats
```
Based off of the calculations it can be concluded that 92.5% of patients didn't have a coma and 2.5% had a deep stupor when they entered the ICU. Additionally, 85% of patients visited the ICU in the past 6 months and 15% did not. Lastly, 46.5% of patients had a medical service, 53.5% had a surgical service, 26.5% had an elective admission, and 73.5% had an emergency admission. 

```{r}
#Medical factors
table(icu$cancer)
table(icu$fracture)
table(icu$PH)
table(icu$PCO2)
table(icu$bicarb)
table(icu$creat)

#Plots of medical factors
barplot(table(icu$cancer))
barplot(table(icu$fracture))
barplot(table(icu$PH))
barplot(table(icu$PCO2))
barplot(table(icu$bicarb))
barplot(table(icu$creat))
```
Based off of the visualizations it can be concluded that the majority of patients did not have cancer or a fracture. The majority also were within the healthy levels of pH, PCO2, bicarbonate, and creatinine.  



```{r}
#Explore relationship between vital status and age

#First look at the distributions of each variable
table(icu$vital.status)
barplot(table(icu$vital.status))

hist(icu$age)
table(icu$age)
```
It is important to note that the vital.status variable is binary and the distribution of the age of people in this data set is highest between the ages of 60-80. This is important when analyzing the vital status variable because there is a largely different frequency for each age group. It is also interesting that 20% of population died.    

```{r}
#Plot the relationship between vital status and age
plot(icu$vital.status, icu$age)
```
Based on the plot between both variables, it is clear that as people get older, their chance of dying is much higher than people that are younger. We can see that the mean of people that died is roughly 70 whereas, the mean the people that lived is closer to 60. It is also important to note that there are two outliers in the people that died. This again shows that it was rare to have very young people die.    


```{r}
#Explore relationship between vital status and sys blood pressure
hist(icu$sys)
table(icu$sys)
barplot(table(icu$sys))
```
We can see that the majority of people in this data set had a blood pressures between 100 and roughly 160. We can see that there were much less people with pressure levels that were lower and higher than the majority. This makes sense because therr typically is a systolic pressure range that healthy people should have and when there are health issues, those values can increase and decrease.  

```{r}
#Plot the relationship between vital status and sys blood pressure
plot(icu$vital.status, icu$sys)
```

Based on the plot it can be concluded that people with higher systolic blood pressure levels had higher chances of survival. If individuals had lower blood pressure levels, then they were at a higher risk of dying. The mean of both variables is roughly at 125, with the mean for died being a little lower. We can also note that the patients who lived had a smaller distribution of their pressure, whereas the patients that dies had much lower pressures. It is also important to note that lived has two outliers, where one is much lower and the other one is much higher. Out of the patients that died, only one was in the upper extreme. 


```{r}
#Explore relationship between vital status and type of service needed
table(icu$service)
barplot(table(icu$service))

#Plot the relationship on a graph
plot(icu$vital.status, icu$service)

#Divide data up by service and vital status
med <- icu %>%
  filter(service == 'medical')

surg <- icu %>%
  filter(service == 'surgical')

print("Medical Services")
table(med$vital.status)
print("Surgical Services")
table(surg$vital.status)
```
Summary Statistics:

Medical -> 93/200 = 0.465
Surgical -> 107/200 = 0.535

Medical that died -> 26/93 = 0.2795699
Surgical that died -> 14/107 = 0.1308411

Based off the breakdown in each service needed, we can see that people who required medical services had a higher number of deaths compared to those that needed surgery. It is very interesting because the number of patients in each service is roughly the same, so the difference between deaths is quite peculiar. This does not makes logical sense because surgery is often much more dangerous and can lead to more complications compared to medical services. It is quite hard to tell what the medical services are based off of this analysis to reason as to why the death rates are higher.   

```{r}
#Explore relationship between vital status and type of admission
table(icu$type)
barplot(table(icu$type))

#Plot the relationship on a graph
plot(icu$vital.status, icu$type)

#Divide data up by service and type
elec <- icu %>%
  filter(type == 'elective')

emg <- icu %>%
  filter(type == 'emergency')

print("Elective Type")
table(elec$vital.status)
print("Emergency Type")
table(emg$vital.status)

```
Summary Statistics:
Elective -> 53/200 = 0.265
Emergency -> 147/200 = 0.735

Elective that died -> 2/53 = 0.03773585
Emergency that died -> 38/147 = 0.2585034

We can conclude that patients who went to the ICU due to an emergency had a higher death rate in comparison to those that elected to go. It is also important to notice that less than roughly half of the number of emergency patients were elective. This shows that the majority people that went to the ICU were in emergency situations, which does logically make sense. It is also shocking to see that only 38 out of the total number of 147 emergency patients died. I have always assumed that the death rates would be very high depending upon the extreme situations that patients are in. 


```{r}
#Check demographics of age, gender, and race compared to vital status

#Preliminary analysis for each predictor variable
hist(icu$age)
barplot(table(icu$gender))
barplot(table(icu$race))

barplot(table(icu$vital.status))

#Explore the relationship 
plot(icu$vital.status, icu$age)
plot(icu$vital.status, icu$gender)
plot(icu$vital.status, icu$race)
```
Since the plots were not very helpful in determining whether there was an association between both variables, chi-square tests were conducted.

```{r}
#Chi-square tests in order to determine association

#Vitals & Age
#Create a table to understand the number of values in each section
vitals.age = table(icu$vital.status, icu$age,
                     dnn = c("Vital Status", "Age"))
addmargins(vitals.age)
chisq.test(vitals.age)
```
Since the p-value(0.005165) from the chi-square test is less than 0.05, it allows us to reject our null hypothesis and we can determine that age does have an association with vital status.

```{r}
#Vitals & Gender
#Create a table to understand the number of values in each section
vitals.gender = table(icu$vital.status, icu$gender,
                     dnn = c("Vital Status", "Gender"))
addmargins(vitals.gender)
chisq.test(vitals.gender)
```
The p-value for vitals and gender is 0.913, which is not less than 0.05 so we cannot reject our null hypothesis. This means that there is no association between gender and vital status. The p-value is extremely high which does not mean significance.  

```{r}
#Vitals & Race
#Create a table to understand the number of values in each section
vitals.race = table(icu$vital.status, icu$race,
                     dnn = c("Vital Status", "Race"))
addmargins(vitals.race)
chisq.test(vitals.race)
```
The p-value for vitals and gender is 0.4046, which is not less than 0.05 so we cannot reject our null hypothesis. This means that there is no association between race and vital status. 

```{r}
#ABG & Vital 
#The ABG factors are columns 15-18, so the values are PO2, PH, PCO2, & bicarb

#Check PO2 Variable
barplot(table(icu$PO2))

#Vitals & PO2
vitals.po2 = table(icu$vital.status, icu$PO2,
                     dnn = c("Vital Status", "Oxygen Partial Pressure"))
addmargins(vitals.po2)
chisq.test(vitals.po2)
```

```{r}
#Check PH Variable
barplot(table(icu$PH))

#Vitals & PH
vitals.ph = table(icu$vital.status, icu$PH,
                     dnn = c("Vital Status", "Normal Blood pH"))
addmargins(vitals.ph)
chisq.test(vitals.ph)
```

```{r}
#Check PCO2 Variable
barplot(table(icu$PCO2))

#Vitals & PCO2
vitals.pco2 = table(icu$vital.status, icu$PCO2,
                     dnn = c("Vital Status", "Carbon Dioxide Partial Pressure"))
addmargins(vitals.pco2)
chisq.test(vitals.pco2)
```

```{r}
#Check bicarb Variable
barplot(table(icu$bicarb))

#Vitals & bicarb
vitals.bicarb = table(icu$vital.status, icu$bicarb,
                     dnn = c("Vital Status", "Bicarbonate Level"))
addmargins(vitals.bicarb)
chisq.test(vitals.bicarb)
```
P-values:
  PO2 -> 0.3969
  PH -> 0.5187
  PCO2 -> 1
  bicarb -> 0.3141
  
Based off of the chi-square tests, none of the ABG measures are associated with vital status because all of the p-values are greater than 0.05. After looking at the boxplots of all of the variables, I believe that since each variable has such a high number of patients with the same values, these attributes might not make that much of a difference when it comes to vital status. 

```{r}
#Associated with ICU Mortality

#ICU & Cancer
icu.cancer = table(icu$vital.status, icu$cancer,
                     dnn = c("Vital Status", "Cancer"))
addmargins(icu.cancer)
chisq.test(icu.cancer)
```

```{r}
#ICU & Chronic Renal Failure
icu.renal = table(icu$vital.status, icu$renal,
                     dnn = c("Vital Status", "Renal"))
addmargins(icu.renal)
chisq.test(icu.renal)
```

```{r}
#ICU & Probable Infection
icu.infect = table(icu$vital.status, icu$infect.prob,
                     dnn = c("Vital Status", "Probable Infection"))
addmargins(icu.infect)
chisq.test(icu.infect)
```

```{r}
#ICU & Presence of bone fracture
icu.bone = table(icu$vital.status, icu$fracture,
                     dnn = c("Vital Status", "Bone Fracture"))
addmargins(icu.bone)
chisq.test(icu.bone)
```
Resulting p-values:
  Cancer -> 1
  Renal Failure -> 0.0257
  Probable Infection -> 0.01641
  Bone Fracture -> 1
  
Based off of the p-values calculated by the chi-square, we can determine that renal failure and probable infection are both factors that impact a patient's chance of survival. We can make this determination because both variables have p-values that are less than 0.05. 

```{r}
#Based off of part b, we can state that renal failure, probable infection, and age are all variables that impact vital status of a patient
#Logistic regression will be used because vital status is a binary variable


summary(glm(vital.status ~ renal + infect.prob + age, data = icu, family = binomial(link = "logit")))
```
Regression Equation:

log_odds = -3.29684 + 0.94835*renalyes + 0.77453*infect.probyes + 0.02329*age

It is important to note that renalyes has a p-value that is slightly above 0.05, so it is not completely significant. 

```{r}
#The only value that needs to be changed is infection probable, so the other values are arbitrary as long as both patients are the same otherwise
#Each variable will have a 0 if a patient has that attribute and 0 if they do not

#Odds of Mortality given Infection Probable
log_odds_inf = -3.29684 + 0.94835*0 + 0.77453*1 + 0.02329*20
odds_inf = exp(log_odds_inf)
paste("log odds: ", log_odds_inf, sep=" ")
paste("odds: ", odds_inf, sep=" ")

#Odds of Mortality given No Infection Probable
log_odds_no = -3.29684 + 0.94835*0 + 0.77453*0 + 0.02329*20
odds_no = exp(log_odds_no)
paste("log odds: ", log_odds_no, sep=" ")
paste("odds: ", odds_no, sep=" ")

```
We can determine that if a patient is 20 years of age and has a probable infection, they will have 0.12789 odds of living, whereas if that patient does not have a probable infection their odds of living is only 0.05895. The odds ratio is greater than 1 which means that the higher risk is associated with the group of people that have the infection. This does makes sense because someone that is at a risk of having an infection might experience complications that could lead to death. 
